<?php

class SSLHistoryPrinter
{
    protected $unplayed = false;
    
    // TODO
    public function printOut(SSLHistoryDom $tree)
    {
        $tracks = $tree->getTracks();
        
        if(!$this->unplayed)
        {
            $tracks = $this->eliminateUnplayed($tracks);
        }
        
        $tracks = $this->mergeRows($tracks);
        
        foreach($tracks as $track)
        {
            $this->outputRow($track);
        }
    }
    
    protected function eliminateUnplayed(array $tracks)
    {
        $played = array();
        foreach($tracks as $track)
        {
            try
            {
                $data = $track->getData();
            }
            catch(Exception $e)
            {
                continue;
            }
            
            $is_played = false;
            
            if(isset($data['playedOne']))
            {
                $is_played = (bool) $data['playedOne'];
            }
            
            if(isset($data['playedTwo']))
            {
                $is_played = (bool) $data['playedTwo'];
            }
            
            if($is_played)
            {
                $played[] = $track;
            }
        }
        return $played;
    }

    protected function mergeRows(array $tracks)
    {
        return $tracks;
    }
    
    protected function outputRow(SSLOentChunk $track)
    {
        $track = $track->getData();
        echo "{$track['artist']} - {$track['title']}\n";
    }
}